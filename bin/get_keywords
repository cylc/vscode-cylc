#!/usr/bin/env python3
import sys

try:
    from cylc.flow.cfgspec.workflow import SPEC
except (NameError, ImportError):
    print(
        'FAIL: This script requires an environment with cylc.flow installed'
        '\n    ``pip install cylc-flow``'
    )
    sys.exit(1)
else:

    import json

    msg2 = {}
    for num_of_brackets, item in SPEC.walk():
        if item.name.startswith('<') and item.name.endswith('>'):
            continue
        brackets = '[' * (num_of_brackets - 1)
        brackets2 = ']' * (num_of_brackets - 1)
        if item.is_leaf():
            body = item.name + " = "
            body += '${1:' + str(item.default) + '}'
        else:
            body = brackets + item.name + brackets2

        msg2[item.name] = {
            'prefix': item.name,
            'body': body,
            'description': item.desc}

    print(json.dumps(msg2, indent=4))
